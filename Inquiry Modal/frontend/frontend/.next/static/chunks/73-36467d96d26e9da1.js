"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73],{255:(e,t,a)=>{function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),a(5155),a(7650),a(5744),a(589)},2146:(e,t,a)=>{function r(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),a(5262)},4054:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{bindSnapshot:function(){return l},createAsyncLocalStorage:function(){return n},createSnapshot:function(){return i}});let a=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}static bind(e){return e}}let o="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function n(){return o?new o:new r}function l(e){return o?o.bind(e):r.bind(e)}function i(){return o?o.snapshot():function(e,...t){return e(...t)}}},5028:(e,t,a)=>{a.d(t,{default:()=>o.a});var r=a(6645),o=a.n(r)},5744:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=a(7828)},6645:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let r=a(8229)._(a(7357));function o(e,t){var a;let o={};"function"==typeof e&&(o.loader=e);let n={...o,...t};return(0,r.default)({...n,modules:null==(a=n.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7073:(e,t,a)=>{a.d(t,{default:()=>b});var r=a(5155),o=a(2115),n=a(7153),l=a(3462),i=a(5695),s=a(3464),c=a(5028),u=a(6572);let d="".concat(u.A,"/inquiries"),m=(0,c.default)(()=>a.e(630).then(a.bind(a,8630)).then(e=>e.default),{loadableGenerated:{webpack:()=>[8630]},ssr:!1}),y=[{key:"inqDate",label:"INQ Date"},{key:"todayDate",label:"Today Date"},{key:"period",label:"Period"},{key:"sales",label:"Sales"},{key:"buyer",label:"Buyer"},{key:"stockId",label:"Stock ID"},{key:"shape",label:"Shape"},{key:"ct",label:"CT"},{key:"color",label:"Color"},{key:"clarity",label:"Clarity"},{key:"cut",label:"Cut"},{key:"po",label:"PO"},{key:"sym",label:"Sym"},{key:"lab",label:"Lab"},{key:"report",label:"REPORT"},{key:"disPpc",label:"DIS/PPC"},{key:"ppc",label:"PPC"},{key:"amt",label:"AMT"},{key:"type",label:"Type"},{key:"availability",label:"Sale Team Status"},{key:"payment",label:"Payment"},{key:"remark",label:"Remark"},{key:"location",label:"Location"},{key:"otRemark",label:"Backend Status"},{key:"time",label:"Time"},{key:"statusOfStone",label:"Status of Stone"},{key:"qcRemark",label:"QC Remark"},{key:"stoneConfirmationRemark",label:"Stone Confirmation Remark"},{key:"entryStatus",label:"Entry Status"},{key:"locationRemark",label:"Location Remark"}];function b(e){let{title:t,statuses:a,showInvoiceColumn:c=!1}=e,[b,k]=(0,o.useState)([]),[p,f]=(0,o.useState)([]),[_,h]=(0,o.useState)(""),[g,x]=(0,o.useState)(""),[S,v]=(0,o.useState)(""),[j,w]=(0,o.useState)(""),[C,R]=(0,o.useState)(null),O=(0,i.useRouter)(),[P,D]=(0,o.useState)(""),[q,I]=(0,o.useState)([]);(0,o.useEffect)(()=>{let e=(0,l.u)();e?(R(e),T()):O.push("/login")},[]);let T=async()=>{try{let e=localStorage.getItem("token"),t=await fetch(d,{headers:{Authorization:"Bearer ".concat(e)}}),r=(await t.json()).map(e=>({...e,inqDate:e.inquiry_date,todayDate:e.today_date,stockId:e.stock_id,disPpc:e.dis_ppc,availability:e.sale_team_status,remark:e.remark_request,otRemark:e.backend_status,statusOfStone:e.status_of_stone,qcRemark:e.qc_remark,stoneConfirmationRemark:e.stone_confirmation_remark,entryStatus:e.entry_status,locationRemark:e.location_remark})).filter(e=>a.includes(e.availability));k(r),f(r)}catch(e){console.error("Failed to fetch inquiries:",e)}},N=async(e,t)=>{let a=localStorage.getItem("token"),r={...t,sale_team_status:t.availability,backend_status:t.otRemark,dis_ppc:t.disPpc,remark_request:t.remark,stock_id:t.stockId,status_of_stone:t.statusOfStone,qc_remark:t.qcRemark,stone_confirmation_remark:t.stoneConfirmationRemark,entry_status:t.entryStatus,location_remark:t.locationRemark};try{let t=await fetch("".concat(d,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(r)}),o=await t.json(),n=b.map(t=>t.id===e?{...t,...o,inqDate:o.inquiry_date,todayDate:o.today_date,stockId:o.stock_id,disPpc:o.dis_ppc,availability:o.sale_team_status,remark:o.remark_request,otRemark:o.backend_status,statusOfStone:o.status_of_stone,qcRemark:o.qc_remark,stoneConfirmationRemark:o.stone_confirmation_remark,entryStatus:o.entry_status,locationRemark:o.location_remark}:t);k(n),f(n)}catch(e){console.error("Edit failed:",e)}},A=async(e,t,a)=>{let r=localStorage.getItem("token")||"",o=localStorage.getItem("role")||"",n=localStorage.getItem("userName")||"";"".concat(o,"_").concat(n);try{let o=(await s.A.patch("".concat(d,"/").concat(e),{[({disPpc:"dis_ppc",availability:"sale_team_status",otRemark:"backend_status",remark:"remark_request",stockId:"stock_id",statusOfStone:"status_of_stone",qcRemark:"qc_remark",stoneConfirmationRemark:"stone_confirmation_remark",entryStatus:"entry_status",locationRemark:"location_remark"})[t]||t]:a},{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}})).data,n=b.map(t=>t.id===e?{...t,...o,inqDate:o.inquiry_date,todayDate:o.today_date,stockId:o.stock_id,disPpc:o.dis_ppc,availability:o.sale_team_status,remark:o.remark_request,otRemark:o.backend_status,statusOfStone:o.status_of_stone,qcRemark:o.qc_remark,stoneConfirmationRemark:o.stone_confirmation_remark,entryStatus:o.entry_status,locationRemark:o.location_remark}:t);k(n),f(n)}catch(e){console.error("Auto-save failed:",e)}},E=async e=>{console.log("\uD83D\uDDD1 Deleting inquiry:",e);try{let t=localStorage.getItem("token"),a=await fetch("".concat(u.A,"/inquiries/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok){let e=await a.text();throw Error(e||"Delete failed")}k(t=>t.filter(t=>t.id!==e)),f(t=>t.filter(t=>t.id!==e)),console.log("\uD83D\uDDD1 Deleting inquiry with ID:",e)}catch(e){console.error("âŒ Failed to delete inquiry",e),alert("Something went wrong while deleting.")}};return(0,r.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md h-[1000px]",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:t}),(0,r.jsx)("div",{className:"flex flex-wrap gap-4 mb-6 items-end",children:(0,r.jsxs)("form",{className:"flex flex-wrap gap-4 items-end mb-6",onSubmit:e=>{e.preventDefault();let t=j?new Date(j):null;f(b.filter(e=>{let a=new Date(e.inqDate);return(!_||String(e.id).toLowerCase().includes(_.toLowerCase()))&&(!g||e.report&&e.report.toLowerCase().includes(g.toLowerCase()))&&(!S||e.availability&&e.availability.toLowerCase()===S.toLowerCase())&&(!t||a>=t)}))},children:[(0,r.jsx)("input",{type:"text",placeholder:"Inquiry No",className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[140px]",value:_,onChange:e=>h(e.target.value)}),(0,r.jsx)("input",{type:"text",placeholder:"Report No",className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[140px]",value:g,onChange:e=>x(e.target.value)}),(0,r.jsxs)("select",{className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[180px]",value:S,onChange:e=>v(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"Sale Team Status"}),(0,r.jsx)("option",{value:"Available",children:"Available"}),(0,r.jsx)("option",{value:"Not Available",children:"Not Available"}),(0,r.jsx)("option",{value:"Hold",children:"Hold"}),(0,r.jsx)("option",{value:"On Memo",children:"On Memo"}),(0,r.jsx)("option",{value:"Confirmed - TOH",children:"Confirmed - TOH"}),(0,r.jsx)("option",{value:"Hold - TOH",children:"Hold - TOH"}),(0,r.jsx)("option",{value:"Release",children:"Release"}),(0,r.jsx)("option",{value:"ADDED TO STOCK",children:"ADDED TO STOCK"}),(0,r.jsx)("option",{value:"IN EXHIBITION",children:"IN EXHIBITION"}),(0,r.jsx)("option",{value:"Pending",children:"Pending"})]}),(0,r.jsx)("input",{type:"date",className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[180px]",value:j,onChange:e=>w(e.target.value)}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition text-sm",children:"Search"}),(0,r.jsx)("button",{type:"button",onClick:()=>{h(""),x(""),v(""),w(""),f(b)},className:"bg-red-400 text-white px-4 py-2 rounded hover:bg-red-500 transition text-sm",children:"Reset"}),"Dispatched"===t&&(0,r.jsx)(m,{data:p.filter(e=>q.includes(e.id)),headers:y.map(e=>({label:e.label,key:e.key})),filename:"inquiries.csv",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition text-sm",children:"Download Data"})]})}),(0,r.jsx)(n.A,{data:p,columns:y,role:C||"",onEdit:N,onDelete:E,onCheckboxChange:A,defaultAvailability:a[0],selectedRows:q,rowCheckbox:"Dispatched"===t,onRowCheckbox:(e,t)=>{I(a=>t?[...a,e]:a.filter(t=>t!==e))},onSelectAllRows:e=>{e?I(p.map(e=>e.id)):I([])},showInvoiceColumn:c})]})}},7357:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});let r=a(5155),o=a(2115),n=a(2146);function l(e){return{default:e&&"default"in e?e.default:e}}a(255);let i={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},s=function(e){let t={...i,...e},a=(0,o.lazy)(()=>t.loader().then(l)),s=t.loading;function c(e){let l=s?(0,r.jsx)(s,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,c=i?o.Suspense:o.Fragment,u=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(a,{...e})]}):(0,r.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(a,{...e})});return(0,r.jsx)(c,{...i?{fallback:l}:{},children:u})}return c.displayName="LoadableComponent",c}},7828:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,a(4054).createAsyncLocalStorage)()}}]);