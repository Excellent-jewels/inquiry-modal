(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[31],{6083:(e,t,a)=>{Promise.resolve().then(a.bind(a,7116))},7116:(e,t,a)=>{"use strict";a.d(t,{default:()=>m});var r=a(5155),o=a(2115),n=a(7153),s=a(5695),l=a(3462),i=a(3464),d=a(6572);let c="".concat(d.A,"/inquiries"),u=[{key:"inqDate",label:"INQ Date"},{key:"todayDate",label:"Today Date"},{key:"period",label:"Period"},{key:"sales",label:"SALES"},{key:"buyer",label:"Buyer"},{key:"stockId",label:"STOCK ID"},{key:"shape",label:"Shape"},{key:"ct",label:"Ct"},{key:"color",label:"Color"},{key:"clarity",label:"Clarity"},{key:"cut",label:"Cut"},{key:"po",label:"PO"},{key:"sym",label:"SYM"},{key:"lab",label:"LAB"},{key:"report",label:"REPORT"},{key:"disPpc",label:"DIS/PPC"},{key:"ppc",label:"PPC"},{key:"amt",label:"AMT"},{key:"type",label:"Type"},{key:"availability",label:"Sale Team Status"},{key:"payment",label:"Payment"},{key:"remark",label:"Remark/ Request"},{key:"location",label:"Location"},{key:"otRemark",label:"Backend Status"},{key:"time",label:"Time"},{key:"statusOfStone",label:"Status Of Stone"},{key:"qcRemark",label:"QC REMARK"},{key:"stoneConfirmationRemark",label:"Stone Confirmation Remark"},{key:"entryStatus",label:"ENTRY STATUS"},{key:"locationRemark",label:"Location Remark"}];function m(){let[e,t]=(0,o.useState)([]),[a,m]=(0,o.useState)([]),[k,y]=(0,o.useState)(""),[p,b]=(0,o.useState)(""),[_,h]=(0,o.useState)(""),[f,g]=(0,o.useState)(""),[x,S]=(0,o.useState)(null),[v,w]=(0,o.useState)(!0),R=(0,s.useRouter)(),q=(0,s.useSearchParams)(),[D,C]=(0,o.useState)(""),T=localStorage.getItem("token");q.get("newlyAddedId"),(0,o.useEffect)(()=>{let e=(0,l.u)();e?["admin","sales","backend"].includes(e)?(S(e),A()):R.push("/dashboard/inquiries"):R.push("/login"),w(!1)},[]);let A=async()=>{try{let e=await fetch("".concat(c),{headers:{Authorization:"Bearer ".concat(T)}});if(!e.ok){let t=await e.text();throw Error(t||"Failed to fetch inquiries")}let a=await e.json(),r=Array.isArray(a)?a:a.data;if(!Array.isArray(r))return void console.error("❌ API did not return an array:",a);let o=[...r.map(e=>({...e,inqDate:e.inquiry_date,todayDate:e.today_date,stockId:e.stock_id,disPpc:e.dis_ppc,availability:e.sale_team_status,remark:e.remark_request,otRemark:e.backend_status,statusOfStone:e.status_of_stone,qcRemark:e.qc_remark,stoneConfirmationRemark:e.stone_confirmation_remark,entryStatus:e.entry_status,locationRemark:e.location_remark}))].sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()).filter(e=>"Pending"===e.availability);t(o),m(o)}catch(e){console.error("Error fetching inquiries:",e)}},N=async(a,r,o)=>{try{let n=localStorage.getItem("token")||"",s=localStorage.getItem("role")||"",l=localStorage.getItem("userName")||"";if("".concat(s,"_").concat(l),!n)return void console.error("No token found in localStorage.");let c={disPpc:"dis_ppc",availability:"sale_team_status",otRemark:"backend_status",remark:"remark_request",stockId:"stock_id",statusOfStone:"status_of_stone",qcRemark:"qc_remark",stoneConfirmationRemark:"stone_confirmation_remark",entryStatus:"entry_status",locationRemark:"location_remark"}[r]||r,u=(await i.A.patch("".concat(d.A,"/inquiries/").concat(a),{[c]:o},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}})).data,k=[{...u,updated_at:new Date().toISOString(),inqDate:u.inquiry_date,todayDate:u.today_date,stockId:u.stock_id,disPpc:u.dis_ppc,availability:u.sale_team_status,remark:u.remark_request,otRemark:u.backend_status,statusOfStone:u.status_of_stone,qcRemark:u.qc_remark,stoneConfirmationRemark:u.stone_confirmation_remark,entryStatus:u.entry_status,locationRemark:u.location_remark},...e.filter(e=>e.id!==a)].sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime());t(k),m(k),console.log("✅ Auto-saved:",c,o)}catch(e){e.response?console.error("❌ Auto-save failed:",{status:e.response.status,message:e.response.data.detail||e.response.data}):console.error("❌ Auto-save error:",e.message)}},j=async e=>{console.log("\uD83D\uDDD1 Deleting inquiry:",e);try{let a=localStorage.getItem("token"),r=await fetch("".concat(d.A,"/inquiries/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}});if(!r.ok){let e=await r.text();throw Error(e||"Delete failed")}t(t=>t.filter(t=>t.id!==e)),m(t=>t.filter(t=>t.id!==e)),console.log("✅ Deleted:",e)}catch(e){console.error("❌ Failed to delete inquiry",e),alert("Something went wrong while deleting.")}},I=async(a,r)=>{let o={...r,sale_team_status:r.availability,backend_status:r.otRemark,dis_ppc:r.disPpc,remark_request:r.remark,stock_id:r.stockId,payment:r.payment,status_of_stone:r.statusOfStone,qc_remark:r.qcRemark,stone_confirmation_remark:r.stoneConfirmationRemark,entry_status:r.entryStatus,location_remark:r.locationRemark};try{let r=await fetch("".concat(c,"/").concat(a),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T)},body:JSON.stringify(o)});if(!r.ok){let e=await r.text();throw console.error("Failed to update inquiry:",e),Error(e)}let n=await r.json(),s=[{...n,inqDate:n.inquiry_date,todayDate:n.today_date,stockId:n.stock_id,disPpc:n.dis_ppc,availability:n.sale_team_status,remark:n.remark_request,otRemark:n.backend_status,statusOfStone:n.status_of_stone,qcRemark:n.qc_remark,stoneConfirmationRemark:n.stone_confirmation_remark,entryStatus:n.entry_status,locationRemark:n.location_remark},...e.filter(e=>e.id!==a)].sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime());t(s),m(s)}catch(e){console.error("Edit failed:",e)}};return(0,r.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md h-[1000px]",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Inquiries"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6 items-end",children:[(0,r.jsxs)("form",{className:"flex flex-wrap gap-4 items-end mb-6",onSubmit:t=>{t.preventDefault();let a=f?new Date(f):null;m(e.filter(e=>{var t;let r=new Date(e.inqDate);return(!k||String(e.id).includes(k))&&(!p||(null==(t=e.report)?void 0:t.toLowerCase().includes(p.toLowerCase())))&&(!_||e.availability===_)&&(!a||r>=a)}))},children:[(0,r.jsx)("input",{type:"text",placeholder:"Inquiry No",className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[140px]",value:k,onChange:e=>y(e.target.value)}),(0,r.jsx)("input",{type:"text",placeholder:"Report No",className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[140px]",value:p,onChange:e=>b(e.target.value)}),(0,r.jsxs)("select",{className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[180px]",value:_,onChange:e=>h(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"Sale Team Status"}),(0,r.jsx)("option",{value:"Available",children:"Available"}),(0,r.jsx)("option",{value:"Not Available",children:"Not Available"}),(0,r.jsx)("option",{value:"Hold",children:"Hold"}),(0,r.jsx)("option",{value:"On Memo",children:"On Memo"}),(0,r.jsx)("option",{value:"Confirmed - TOH",children:"Confirmed - TOH"}),(0,r.jsx)("option",{value:"Hold - TOH",children:"Hold - TOH"}),(0,r.jsx)("option",{value:"Release",children:"Release"}),(0,r.jsx)("option",{value:"ADDED TO STOCK",children:"ADDED TO STOCK"}),(0,r.jsx)("option",{value:"IN EXHIBITION",children:"IN EXHIBITION"}),(0,r.jsx)("option",{value:"Pending",children:"Pending"})]}),(0,r.jsx)("input",{type:"date",className:"border border-gray-600 rounded px-2 py-1 text-sm min-w-[180px]",value:f,onChange:e=>g(e.target.value)}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition text-sm",children:"Search"}),(0,r.jsx)("button",{type:"button",onClick:()=>{y(""),b(""),h(""),g(""),m(e)},className:"bg-red-400 text-white px-4 py-2 rounded hover:bg-red-500 transition text-sm",children:"Reset"})]}),["admin","sales"].includes(x||"")&&(0,r.jsx)("div",{className:"ml-auto",children:(0,r.jsx)("button",{type:"button",className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition text-sm",onClick:()=>R.push("/dashboard/inquiries/add"),children:"+ New Inquiry"})})]}),(0,r.jsx)(n.A,{data:a,columns:u,onDelete:j,onEdit:I,defaultAvailability:"Pending",role:x||"",onCheckboxChange:N,selectedRows:[]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[464,616,441,684,358],()=>t(6083)),_N_E=e.O()}]);